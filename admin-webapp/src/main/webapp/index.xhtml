<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<f:view contentType="text/html">
    <h:head>
        <script src="http://maps.google.com/maps/api/js" type="text/javascript"/>

        <script type="text/javascript">
            function calcRoute(xhr, status, args) {
                var directionsService = new google.maps.DirectionsService();
                var directionsDisplay = new google.maps.DirectionsRenderer();
                var latlngstart = new google.maps.LatLng($('.latstart').val(), $('.lngstart').val());
                var latlngsend = new google.maps.LatLng($('.latend').val(), $('.lngend').val());
                var map = gmap.getMap();

                directionsDisplay.setMap(map);
                directionsDisplay.setPanel(document.getElementById("directionsPanel"));

                var request = {
                    origin: latlngstart,
                    destination: latlngsend,
                    travelMode: google.maps.TravelMode.DRIVING
                };
                directionsService.route(request, function (response, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response);
                    }
                });

//                var myLatlng = new google.maps.LatLng(-16.3595, -48.9954);

            }
//            google.maps.event.addDomListener(window, 'load', calcRoute);
        </script>

        <h:outputStylesheet>
            html, body {
                height: 100%;
                width: 100%;
            }
        </h:outputStylesheet>
    </h:head>

    <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />

    <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
        <p:graphicImage name="/images/ajax-loader.gif" />
    </p:dialog>

    <h:outputLabel value="Plan"/>
    <h:form style="height: 100%">
        <p:gmap type="HYBRID" center="#{planViewModel.centerLatitude},#{planViewModel.centerLongitude}"
                zoom="15" streetView="true"
                style="height: 100%;width: 100%;"
                model="#{planViewModel.mapModel}"/>
        <p:commandButton global="true" value="Refresh" process="@this" update="@previous" actionListener="#{planViewModel.reloadPlan}" icon="ui-icon-refresh"/>
    </h:form>
</f:view>
</html>
